class Client{constructor({prefix:t="!",self_commands:e=!0,queue:s=!1,queue_max_length:a=5,fetchInterval:i=100,autosaveInterval:n=1e4}={prefix:"!",self_commands:!0,queue:!1,queue_max_length:5,fetchInterval:100,autosaveInterval:1e4}){this.commands=new Map,this.events={},this.handledMessages=null===localStorage.getItem("handledMessages")?new Array:Array.from(JSON.parse(localStorage.getItem("handledMessages"))),setInterval(()=>{if(null!==getChat()){const i=s?[].slice.call(getChat().children,-a):[getChat().lastChild];for(const s of i)if(s.hasAttribute("data-id")&&!this.handledMessages.includes(s.getAttribute("data-id"))){this.handledMessages.push(s.getAttribute("data-id"));const a=this.getMessageFromElement(s);if(void 0!==a){if(e||s.getAttribute("data-id").startsWith("false_"))for(const[e,s]of this.commands.entries())if(a.content.message.startsWith(t+e))return s(a,a.content.message.substring(t.length+e.length).split(" ").splice(1)),void this.emit("command",[e,s]);this.emit("message",a),this.emit("message_"+(s.getAttribute("data-id").startsWith("true_")?"self":"other"),a)}}}},i),setInterval(()=>{localStorage.setItem("handledMessages",JSON.stringify(this.handledMessages))},n),this.emit("init")}registerCommand(t,e){this.commands.set(t,e)}unregisterCommand(t){this.commands.delete(t)}emit(t,...e){for(let s of this.events[t]||[])s(...e)}on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=this.events[t].filter(t=>t!==e)}sendMessage(t){const e=getTextBox().textContent;getTextBox().textContent=t,getTextBox().dispatchEvent(new InputEvent("input",{bubbles:!0})),new Promise(t=>{null!==getSendButton()&&(getSendButton().click(),getTextBox().textContent=e,getTextBox().dispatchEvent(new InputEvent("input",{bubbles:!0})),t())})}gotoNewestChat(){for(const t of getChats().children)if("translateY(0px)"===t.style.transform)return t.firstChild.firstChild.lastChild.firstChild.firstChild.firstChild.firstChild.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))}getMessageFromElement(t){if(null!==t.querySelector("[data-pre-plain-text]"))try{const e=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\] (.*):/)[1],s=t.querySelector("[data-pre-plain-text]").lastChild.children[getChat().lastChild.querySelector("[data-pre-plain-text]").lastChild.childElementCount-2].innerText,a=t.querySelector("[data-pre-plain-text]").firstChild.firstChild.firstChild.lastChild.firstChild.lastChild.innerText,i=Array.from(t.querySelector("[data-pre-plain-text]").querySelectorAll("[src^=data]")),n=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\[(.*)\]/)[1];return new Message(e,new MessageContent(s,a,i),n)}catch(e){const s=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\] (.*):/)[1],a=t.querySelector("[data-pre-plain-text]").lastChild.children[getChat().lastChild.querySelector("[data-pre-plain-text]").lastChild.childElementCount-2].innerText,i=Array.from(t.querySelector("[data-pre-plain-text]").querySelectorAll("[src^=data]")),n=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\[(.*)\]/)[1];return new Message(s,new MessageContent(a,null,i),n)}}}const getTextBox=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div._3uMse > div > div._3FRCZ.copyable-text.selectable-text"),getSendButton=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div:nth-child(3) > button"),getChat=()=>document.querySelector("#main > div._3h-WS > div > div > div.z_tTQ"),getChats=()=>document.querySelector("#pane-side > div:nth-child(1) > div > div");class Message{constructor(t,e,s){this.sender=t,this.content=e,this.timestamp=s}}class MessageContent{constructor(t,e,s){this.message=t,this.reaction=e,this.images=s}}